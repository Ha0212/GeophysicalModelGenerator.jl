<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Visualize 3D seismic tomography · GeophysicalModelGenerator.jl</title><link rel="canonical" href="https://github.com/JuliaGeodynamics/GeophysicalModelGenerator.jl/man/tutorial_load3DSeismicData/"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">GeophysicalModelGenerator.jl</span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../tutorials/">Overview</a></li><li class="is-active"><a class="tocitem" href>Visualize 3D seismic tomography</a><ul class="internal"><li><a class="tocitem" href="#Goal"><span>Goal</span></a></li><li><a class="tocitem" href="#Steps"><span>Steps</span></a></li></ul></li><li><a class="tocitem" href="../tutorial_loadirregular3DSeismicData/">Interpolate irregular 3D seismic tomography</a></li></ul></li><li><span class="tocitem">User Guide</span><ul><li><a class="tocitem" href="../datastructures/">Data Structures</a></li><li><a class="tocitem" href="../paraview_output/">Paraview output</a></li><li><a class="tocitem" href="../gravity_code/">Gravity code</a></li></ul></li><li><a class="tocitem" href="../listfunctions/">List of functions</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorials</a></li><li class="is-active"><a href>Visualize 3D seismic tomography</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Visualize 3D seismic tomography</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/JuliaGeodynamics/GeophysicalModelGenerator/master/docs/src/man/tutorial_load3DSeismicData.md#" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="D-tomography-model-in-CSV-formation"><a class="docs-heading-anchor" href="#D-tomography-model-in-CSV-formation">3D tomography model in CSV formation</a><a id="D-tomography-model-in-CSV-formation-1"></a><a class="docs-heading-anchor-permalink" href="#D-tomography-model-in-CSV-formation" title="Permalink"></a></h1><h2 id="Goal"><a class="docs-heading-anchor" href="#Goal">Goal</a><a id="Goal-1"></a><a class="docs-heading-anchor-permalink" href="#Goal" title="Permalink"></a></h2><p>This explains how to load a 3D P-wave model and plot it in paraview as a 3D volumetric data set. The example is the P-wave velocity model of the alps as described in </p><p>Zhao, L., Paul, A., Malusà, M.G., Xu, X., Zheng, T., Solarino, S., Guillot, S., Schwartz, S., Dumont, T., Salimbeni, S., Aubert, C., Pondrelli, S., Wang, Q., Zhu, R., 2016. <em>Continuity of the Alpine slab unraveled by high-resolution P wave tomography</em>. Journal of Geophysical Research: Solid Earth 121, 8720–8737. https://doi.org/10.1002/2016JB013310</p><p>The data is given in ASCII format with longitude/latitude/depth/velocity anomaly (percentage) format.</p><h2 id="Steps"><a class="docs-heading-anchor" href="#Steps">Steps</a><a id="Steps-1"></a><a class="docs-heading-anchor-permalink" href="#Steps" title="Permalink"></a></h2><h4 id=".-Download-data"><a class="docs-heading-anchor" href="#.-Download-data">1. Download data</a><a id=".-Download-data-1"></a><a class="docs-heading-anchor-permalink" href="#.-Download-data" title="Permalink"></a></h4><p>The data is can be downloaded from <a href="https://seafile.rlp.net/d/a50881f45aa34cdeb3c0/">https://seafile.rlp.net/d/a50881f45aa34cdeb3c0/</a>, where you should download the file <code>Zhao_etal_JGR_2016_Pwave_Alps_3D_k60.txt</code>. Do that and start julia from the directory where it was downloaded.</p><h4 id=".-Read-data-into-Julia"><a class="docs-heading-anchor" href="#.-Read-data-into-Julia">2. Read data into Julia</a><a id=".-Read-data-into-Julia-1"></a><a class="docs-heading-anchor-permalink" href="#.-Read-data-into-Julia" title="Permalink"></a></h4><p>The dataset has no comments, and the data values in every row are separated by a space. In order to read this into julia as a matrix, we can use the build-in julia package <code>DelimitedFiles</code>.    We want the resulting data to be stored as double precision values (<code>Float64</code>), and the end of every line is a linebreak (<code>\n</code>).</p><pre><code class="language-julia">julia&gt; using DelimitedFiles
julia&gt; data=readdlm(&quot;Zhao_etal_JGR_2016_Pwave_Alps_3D_k60.txt&quot;,&#39; &#39;,Float64,&#39;\n&#39;, skipstart=0,header=false)
1148774×4 Matrix{Float64}:
  0.0   38.0   -1001.0  -0.113
  0.15  38.0   -1001.0  -0.081
  0.3   38.0   -1001.0  -0.069
  0.45  38.0   -1001.0  -0.059
  0.6   38.0   -1001.0  -0.055
  0.75  38.0   -1001.0  -0.057
  ⋮                     
 17.25  51.95     -1.0  -0.01
 17.4   51.95     -1.0  -0.005
 17.55  51.95     -1.0   0.003
 17.7   51.95     -1.0   0.007
 17.85  51.95     -1.0   0.006
 18.0   51.95     -1.0   0.003</code></pre><p>Next, extract vectors from it:</p><pre><code class="language-julia">julia&gt; lon        = data[:,1];
julia&gt; lat        = data[:,2];
julia&gt; depth      = data[:,3];
julia&gt; dVp_perc   = data[:,4];</code></pre><p>Note that depth needs to with negative numbers.</p><h4 id=".-Reformat-the-data"><a class="docs-heading-anchor" href="#.-Reformat-the-data">3. Reformat the data</a><a id=".-Reformat-the-data-1"></a><a class="docs-heading-anchor-permalink" href="#.-Reformat-the-data" title="Permalink"></a></h4><p>Let&#39;s first have a look at the depth range of the data set:</p><pre><code class="language-julia">julia&gt; Depth_vec = unique(depth)
101-element Vector{Float64}:
 -1001.0
  -991.0
  -981.0
  -971.0
  -961.0
  -951.0
     ⋮
   -51.0
   -41.0
   -31.0
   -21.0
   -11.0
    -1.0</code></pre><p>So the data has a vertical spacing of 10 km. Next, let&#39;s check if the data is spaced in a regular manner in Lon/Lat direction.  For that, we read the data at a given depth level (say -101km) and plot it using the <code>Plots</code> package (you may have to install that first on your machine).</p><pre><code class="language-julia">julia&gt; using Plots
julia&gt; ind=findall(x -&gt; x==-101.0, depth)
julia&gt; scatter(lon[ind],lat[ind],marker_z=dVp_perc[ind], ylabel=&quot;latitude&quot;,xlabel=&quot;longitude&quot;,markersize=2.5, c = :roma)</code></pre><p><img src="../../assets/img/Tutorial_Zhao_LatLon_data.png" alt="DataPoints"/></p><p>Note that we employ the scientific colormap <code>roma</code> here. <a href="https://docs.juliaplots.org/latest/generated/colorschemes/">This</a> gives an overview of available colormaps. You can download the colormaps for Paraview <a href="https://www.fabiocrameri.ch/visualisation/">here</a>.  </p><p>Clearly, the data is given as regular Lat/Lon points</p><pre><code class="language-julia">julia&gt; unique(lon[ind])
121-element Vector{Float64}:
  0.0
  0.15
  0.3
  0.45
  0.6
  0.75
  ⋮
 17.25
 17.4
 17.55
 17.7
 17.85
 18.0
 julia&gt; unique(lat[ind])
94-element Vector{Float64}:
 38.0
 38.15
 38.3
 38.45
 38.6
 38.75
  ⋮
 51.2
 51.35
 51.5
 51.65
 51.8
 51.95
 ```

#### 3.1 Reshape data and save to paraview
Next, we reshape the vectors with lon/lat/depth data into 3D matrixes:</code></pre><p>julia&gt; resolution =  (length(unique(lon)), length(unique(lat)), length(unique(depth))) (121, 94, 101) julia&gt; Lon          = reshape(lon,      resolution); julia&gt; Lat          = reshape(lat,      resolution); julia&gt; Depth        = reshape(depth,    resolution); julia&gt; dVp<em>perc</em>3D  = reshape(dVp_perc, resolution);</p><pre><code class="language-none">
Check that the results are consistent</code></pre><p>julia julia&gt; iz=findall(x -&gt; x==-101.0, Depth[1,1,:]) 1-element Vector{Int64}:  91 julia&gt; data=dVp<em>perc</em>3D[:,:,iz]; julia&gt; heatmap(unique(lon), unique(lat),data[:,:,1]&#39;, c=:roma,title=&quot;Depth[1, 1, iz] km&quot;)</p><pre><code class="language-none">![DataPoints](../assets/img/Tutorial_Zhao_LatLon_data_101km.png)

So this looks good.

Next we create a paraview file:</code></pre><p>julia julia&gt; using GeophysicalModelGenerator julia&gt; Data<em>set    =   GeoData(Lon,Lat,Depth,(dVp</em>Percentage=dVp<em>perc</em>3D,)) GeoData    size  : (121, 94, 101)   lon   ϵ [ 0.0 - 18.0]   lat   ϵ [ 38.0 - 51.95]   depth ϵ [ -1001.0 km - -1.0 km]   fields: (:dVp<em>Percentage,) julia&gt; Write</em>Paraview(Data<em>set, &quot;Zhao</em>etal<em>2016</em>dVp<em>percentage&quot;) 1-element Vector{String}:  &quot;Zhao</em>etal<em>2016</em>dVp_percentage.vts&quot;</p><pre><code class="language-none">
#### 4. Plotting data in Paraview
In paraview you can open the file and visualize it. 

![Paraview_1](../assets/img/Tutorial_Zhao_Paraview_1.png)

The red ellipses show some of the properties you have to select. 
This employs the default colormap, which is not particularly good.

You can change that by importing the roma colormap (using the link described earlier). For this, open the colormap editor and click the one with the heart on the right hand side. Next, import roma and select it.

![Paraview_2](../assets/img/Tutorial_Zhao_Paraview_2.png)

In order to change the colorrange select the button in the red ellipse and change the lower/upper bound.
![Paraview_3](../assets/img/Tutorial_Zhao_Paraview_3.png)

If you want to create a horizontal cross-section @ 200 km depth, you need to select the `Slice` tool, select `Sphere` as a clip type, set the center to `[0,0,0]` and set the radius to `6171` (=radius earth - 200 km).

![Paraview_4](../assets/img/Tutorial_Zhao_Paraview_4.png)


After pushing `Apply`, you&#39;ll see this:

![Paraview_5](../assets/img/Tutorial_Zhao_Paraview_5.png)

If you want to plot iso-surfaces (e.g. at -3%), you can use the `Clip` option again, but this time select `scalar` and don&#39;t forget to unclick `invert`.

![Paraview_6](../assets/img/Tutorial_Zhao_Paraview_6.png)


#### 5. Julia script

The full julia script that does it all is given [here](https://github.com/JuliaGeodynamics/GeophysicalModelGenerator.jl/blob/main/tutorial/Alps_VpModel_Zhao_etal_JGR2016.jl). You need to be in the same directory as in the data file, after which you can run it in julia with</code></pre><p>julia julia&gt; include(&quot;Alps<em>VpModel</em>Zhao<em>etal</em>JGR2016.jl&quot;) ```</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../tutorials/">« Overview</a><a class="docs-footer-nextpage" href="../tutorial_loadirregular3DSeismicData/">Interpolate irregular 3D seismic tomography »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Monday 14 June 2021 15:12">Monday 14 June 2021</span>. Using Julia version 1.6.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
